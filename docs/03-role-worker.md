# 03 工人行事曆與憲法 (The Worker Role)

當 Initiator (架構師) 完成建廠後，會產生一個專屬於該工人的底層資料夾（例如 `.jules/` 或 `.dev-bot/`）。
裡面包含了一個極為重要的檔案：**`AGENT_PROTOCOL.md` (工人憲法)**。

任何被派來這個工廠寫程式的 AI，在每次被喚醒時，都**必須**首先閱讀這份憲法。

## 憲法中最核心的三大鐵律

### 1. 防撞車機制 (Mutex Lock via Git)
在非同步的併發環境中，可能有兩個工人同時醒來想做同一個任務。
憲法強制規定，工人在開始實作前，必須使用 Git 指令檢查遠端 (Origin) 是否已經存在該任務的專屬分支 `task-{task_id}` 或是已開啟的 PR。
如果有，工人必須立刻放棄，這完美解決了分散式開發的死鎖與衝突。

### 2. 八大破壞性邊界測試 (Edge Case Checklist)
我們極度不信任 AI 寫出的「快樂路徑 (Happy Path)」代碼。憲法強制要求工人在提交 PR 之前，他寫的自動化測試必須涵蓋：
- `Null/Undefined` 崩潰測試
- 空陣列 / 空字串的防呆
- 邊界數值 (Max/Min)
- **錯誤路徑恢復** (API Timeout、DB 連線失敗)
- **併發競爭 (Race Conditions)**

### 3. 機械式路徑檢查 (Allowed Paths Audit) [NEW]
為了防止代碼漂移 (Scope Creep)，工人現在被施加了「物理枷鎖」。
- **路徑審計**：在提交前執行 `git diff`，所有變更必須精確落在 `allowed_paths` 內。
- **防止擴張**：嚴禁在單一任務中偷偷修改框架底層或不相關模組。

### 4. 標籤驅動安全性 PR (Label-Based Merge) [NEW]
自動合併不再依賴不安全的 PR Body 字串標註，而是由具備 `PAT_TOKEN` 權限的系統通過 **Label (`auto-merge`)** 進行仲裁與合併，徹底杜絕注入風險。

### 3. 認知上限守則與樂高法 (Cognitive Load Limit)
AI 寫程式很快，但如果讓他無限制地往下寫，檔案會變得極度肥大，最終導致 AI 自己的 Context Window (脈絡視窗) 崩潰而陷入幻覺。
因此，憲法中下了最嚴厲的軍令狀：
*   **檔案長度控制**：盡量保持在 200~300 行以內。
*   **反模式禁令**：絕對禁止寫出「全能上帝物件 (God Object)」或「大泥球 (Big Ball of Mud)」。
*   **壞了就換 (Disposable Components)**：如果舊有的小型模組充滿 Bug 難以修復，請果斷。**刪除並重寫**，嚴禁疊床架屋地修補。

只要遵守這份憲法，AI 工人就能源源不絕地產出高品質、高穩定、且容易被人類維護的商業級代碼。
