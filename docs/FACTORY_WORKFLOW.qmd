---
title: "ðŸ­ Factory Workflow Blueprint"
subtitle: "The Literate State Machine of Software Production"
---

# ðŸ­ Autonomous Software Factory Workflow

> \[!NOTE\] This is an **Executable Document**. It not only describes the workflow but also serves as the real-time monitoring interface for the factory.

## ðŸ—ï¸ Core Architecture: 6-Role Decoupled Pipeline

The factory is composed of six specialized autonomous components orchestrated by a central brain.

### ðŸ—ºï¸ æˆ°ç•¥å…¨æ™¯ï¼šè»Ÿé«”å·¥å» ç”Ÿå‘½é€±æœŸ

> æ—¨åœ¨å‘ˆç¾ 6 å€‹è§’è‰²é–“çš„é«˜éšŽå”ä½œèˆ‡ç‹€æ…‹è½‰ç§»ã€‚

```{mermaid}
graph TD
    User([ðŸ‘©â€ðŸ’» äººé¡žæ„åœ–]) --> P1[[Phase 1: Discovery]]
    P1 --> P2[[Phase 2: Tech Design]]
    P2 --> P3[[Phase 3: Task Specification]]
    P3 --> P4[[Phase 4: Dispatch]]
    P4 --> P5[[Phase 5: Execution]]
    P5 --> P6[[Phase 6: Validation]]
    P6 -- "åé¥‹/é‡è©¦" --> P5
    P6 -- "Phase æŽ¨é€²" --> P4
    P6 -- "å®Œæˆ" --> Done((ðŸš€ ç™¼å¸ƒ))

    style P1 fill:#e3f2fd,stroke:#1565c0,color:#0d47a1
    style P2 fill:#fffde7,stroke:#fbc02d,color:#f57f17
    style P3 fill:#f3e5f5,stroke:#7b1fa2,color:#4a148c
    style P4 fill:#fff3e0,stroke:#e65100,color:#bf360c
    style P5 fill:#e8f5e9,stroke:#2e7d32,color:#1b5e20
    style P6 fill:#ffebee,stroke:#c62828,color:#b71c1c
```

------------------------------------------------------------------------

## ðŸ” æˆ°è¡“æ‹†è§£ï¼šå„éšŽæ®µè©³ç´°é‚è¼¯

### 1. Discovery: æ„åœ–å…·ç¾åŒ–

> å°‡æ¨¡ç³Šçš„è‡ªç„¶èªžè¨€è½‰åŒ–ç‚ºå¯åŸ·è¡Œçš„è¦–è¦ºèˆ‡åŠŸèƒ½éœ€æ±‚ã€‚

```{mermaid}
graph TD
    Start([äººé¡žè¼¸å…¥]) --> Orch{å”ä½œç·¨ç¨‹å™¨}
    Orch --> ReqA[éœ€æ±‚åˆ†æžå¸«]
    ReqA --> UI_Check{éœ€è¦ UI?}
    UI_Check -- æ˜¯ --> VisD[è¦–è¦ºè¨­è¨ˆå¸«]
    UI_Check -- å¦ --> Arch[æž¶æ§‹å¯©æŸ¥]
    VisD --> Arch
```

### 2. Tech Design â†’ Task Specification

> ç¢ºä¿æž¶æ§‹å…§èšå¾Œï¼Œå°‡éœ€æ±‚æ‹†è§£ç‚ºæ¨¡çµ„åŒ–å¾®åž‹ä»»å‹™ã€‚

```{mermaid}
graph TD
    In[éœ€æ±‚è—åœ–] --> Arch[æž¶æ§‹å¯©æŸ¥å“¡]
    Arch --> Sim[å¤§æ¨¡åž‹è…¦åŠ›æ¨¡æ“¬]
    Sim -- ç°½ç½²é€šéŽ --> Iter[å·¥å» è¿­ä»£å™¨]
    Iter --> Specs[(specs/*.yml)]
    Iter --> Track[(tracker.json)]

    style Sim fill:#fff9c4,stroke:#fbc02d
    style Specs fill:#f5f5f5,stroke:#9e9e9e
```

### 3. Dispatch â†’ Execution â†’ Validation

> Task Dispatcher å°ˆè·èª¿åº¦ï¼ŒWorker ç´”ç²¹å¯¦ä½œï¼ŒCI/CD è£æ±ºçµæžœã€‚

::: callout-note
#### ðŸ¤– Dispatcher = æ•™å°Žè€…ï¼Œéžèª¿åº¦å“¡
Task Dispatcher æ˜¯ä¸€æ¬¡æ€§çš„æ•™å°Žè€… (`mode: instructor`)ã€‚ä»–è¢«å–šé†’ä¸€æ¬¡ï¼Œç”¢å‡ºä¸€æ®µã€Œå¯é‡è¤‡ä½¿ç”¨çš„ Worker Promptã€å¾Œå³é€€å ´ã€‚ä½¿ç”¨è€…åªéœ€åè¦†å°‡æ­¤ Prompt é¤µçµ¦ Worker Agentï¼ˆé€éŽ Web GUIã€APIã€Cron ç­‰ä»»ä½•æ–¹å¼ï¼‰ï¼ŒWorker å°±æœƒè‡ªå‹•è®€å– trackerã€é ˜å–ä»»å‹™ã€å¯¦ä½œã€æ PRã€‚CI/CD è² è²¬é©—æ”¶èˆ‡ Phase æŽ¨é€²ã€‚æ•´å€‹åŸ·è¡ŒéšŽæ®µä¸æ¶ˆè€—é¡å¤–çš„ LLM èª¿åº¦æˆæœ¬ã€‚
:::

```{mermaid}
graph TD
    Disp[ä»»å‹™èª¿åº¦å®˜] --> Lock{äº’æ–¥éŽ–æª¢æŸ¥}
    Lock -- å¯é ˜å– --> Pack[çµ„è£ä»»å‹™åŒ…]
    Lock -- å·²éŽ–å®š --> Skip[è·³éŽ]
    Pack --> Worker[åŸ·è¡Œå·¥äºº]
    Worker -- æäº¤ PR --> CI{CI é–€æˆ¶}
    CI -- é€šéŽ --> Merge[åˆä½µ]
    CI -- å¤±æ•— --> Retry{å¯é‡è©¦?}
    Retry -- æ˜¯ --> Disp
    Retry -- å¦ --> Human([é€šçŸ¥äººé¡ž])
    Merge --> Phase{Phase å®Œæˆ?}
    Phase -- æ˜¯ --> Disp
    Phase -- å…¨éƒ¨å®Œæˆ --> Done((ðŸš€ ç™¼å¸ƒ))

    style Disp fill:#fff3e0,stroke:#e65100
    style Worker fill:#e8f5e9,stroke:#2e7d32
    style Merge fill:#c8e6c9,stroke:#2e7d32
```

------------------------------------------------------------------------

## ðŸ“Š Live Factory Status (Experimental)

::: callout-tip
### é€²åº¦è‡ªå‹•åŒ–ç›£æŽ§

ä»¥ä¸‹å€å¡Šæœƒè‡ªå‹•æœå°‹å°ˆæ¡ˆä¸­çš„ `tracker.json` ä¸¦å‘ˆç¾å³æ™‚é€²åº¦ã€‚
:::

``` python
import json
import os
import glob

tracker_files = glob.glob(".*/tracker.json")
if tracker_files:
    tracker_path = tracker_files[0]
    with open(tracker_path, 'r', encoding='utf-8') as f:
        data = json.load(f)
    print(f"**Current Phase:** {data.get('current_phase', 'N/A')}")
else:
    print("> âš ï¸ No active tracker found. Factory is currently idle.")
```

> \[!NOTE\] **åˆæ¬¡éƒ¨ç½²èªªæ˜Ž**ï¼šè‹¥æ‚¨å‰›å»ºç«‹å°ˆæ¡ˆä¸”å°šæœªåŸ·è¡Œ Factory Iterator çš„å»ºå» æµç¨‹ (Scaffolding)ï¼Œä¸Šæ–¹é¡¯ç¤ºã€ŒNo active tracker foundã€æ˜¯æ­£å¸¸ç¾è±¡ã€‚å¾… `tracker.json` è¢« commit é€²å€‰åº«å¾Œï¼Œæ­¤å€å¡Šå°‡è‡ªå‹•é¡¯ç¤ºå³æ™‚é€²åº¦ã€‚

------------------------------------------------------------------------

## ðŸ› ï¸ è§’è‰²å®šç¾© (6-Role Pipeline)

| \# | è§’è‰² | è·è²¬ | Skill |
|:--|:--|:--|:--|
| 1 | [Requirements Analyst](../skills/requirements-analyst/SKILL.md) | æ„åœ–åˆ†é¡žèˆ‡éœ€æ±‚æ”¶é›† | `requirements-analyst` |
| 2 | [Visual Designer](../skills/visual-designer/SKILL.md) | **(å¯é¸)** è¨­è¨ˆç³»çµ±èˆ‡è¦–è¦ºè¦æ ¼ | `visual-designer` |
| 3 | [Architect Reviewer](../skills/architect-reviewer/SKILL.md) | æŠ€è¡“é¸åž‹èˆ‡æ²™ç›¤æŽ¨æ¼” | `architect-reviewer` |
| 4 | [Factory Iterator](../skills/factory-iterator/SKILL.md) | ä»»å‹™æ‹†è§£ã€è¦æ ¼ç”¢å‡ºã€CI æŠ€è¡“æ£§é©é… | `factory-iterator` |
| 5 | [Task Dispatcher](../skills/task-dispatcher/SKILL.md) | ä¸€æ¬¡æ€§æ•™å°Žè€… (`mode: instructor`)ï¼šç”¢å‡º Worker Prompt | `task-dispatcher` |
| 6 | Worker (AGENT_PROTOCOL) | Dispatcher æ•™å°Žçš„è‡ªæœå‹™åŸ·è¡Œè€… | co-worker |

::: callout-note
#### ðŸ”® åˆ†æ•£å¼ Worker ç®¡ç† (Future Feature)
ç›®å‰æ¡†æž¶ä»¥**å–®ä¸€ Worker ä¸²è¡Œè¿­ä»£**é‹ä½œã€‚åˆ†æ•£å¼ Worker èª¿åº¦å·²è¦åŠƒç‚ºæœªä¾†åŠŸèƒ½ï¼Œå±†æ™‚åªéœ€å°‡ Task Dispatcher å¾ž `mode: instructor` å‡ç´šç‚º `mode: live`ã€‚
:::

------------------------------------------------------------------------

> \[!TIP\] **Literate Strategy**: By using `.qmd`, we ensure that the documentation evolves with the code. If a new skill is added, it must be registered in this blueprint.