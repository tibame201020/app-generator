---
title: "ðŸ”„ Factory Workflow Diagram"
subtitle: "Full-scale Architecture & Decision Logic"
format:
  html:
    page-layout: full
---

:::: column-screen-inset
::: {#workflow-diagram style="text-align: center; overflow: visible;"}
```{dot}
//| fig-width: 100%
//| fig-format: svg
digraph G {
    graph [
        rankdir=TB,
        nodesep=0.5,
        ranksep=0.7,
        splines=curved,      // ä¿ç•™æ›²ç·šå¢žåŠ ç¾Žæ„Ÿ
        pad=0.3,
        bgcolor="transparent",
        center=true
    ]
    
    fontname="Arial"
    fontsize=24
    label="Autonomous Software Factory: Architecture Roadmap"
    labelloc="t"

    node [
        fontname="Arial", 
        shape=box, 
        style="filled,rounded", 
        fillcolor="#f9f9f9", 
        color="#333333",
        fontsize=12,
        width=2.5,
        height=0.8,
        margin=0.1
    ]
    
    edge [
        fontname="Arial", 
        color="#666666",
        fontsize=10,
        penwidth=1.2
    ]

    // --- ç°¡åŒ–çš„ç›¸ä½å°é½Šç³»çµ± (é¿å… WASM è¨˜æ†¶é«”æº¢ä½) ---
    // æ¯å€‹ Phase çš„ç¬¬ä¸€å€‹ç¯€é»žå¼·åˆ¶åœ¨åŒä¸€ Rank
    { rank=same; Human; Arch; Iter; CI_Gate }

    // ä¸»å‹•åŠ›å°Žå‘è·¯å¾‘ (ç¢ºä¿å·¦è‡³å³é †ä½)
    Human -> Arch -> Iter -> CI_Gate [style=invis, minlen=3]

    // --- Phase 1: Discovery ---
    subgraph cluster_0 {
        label = "Phase 1: Discovery";
        color = "#e8f5e9";
        style = "filled,dashed";
        fillcolor = "#f1f8e9";
        
        node [group=g1]
        Human [shape=circle, label="ðŸ‘©â€ðŸ’» Human", fillcolor="#e1f5fe", width=1.0, height=1.0]
        Orch [label="ðŸ Factory Orchestrator", fillcolor="#fff9c4"]
        ReqA [label="ðŸ“ Requirements Analyst"]
        D_UI [shape=diamond, label="Needs UI?", fillcolor="#ffffff"]
        VisD [label="ðŸŽ¨ Visual Designer", style="filled,dashed,rounded", fillcolor="#ffffff"]
        
        Human -> Orch -> ReqA -> D_UI
        D_UI -> VisD [label="Yes"]
    }

    // --- Phase 2: Tech Design ---
    subgraph cluster_1 {
        label = "Phase 2: Tech Design";
        color = "#fff3e0";
        style = "filled,dashed";
        fillcolor = "#fff8e1";
        
        node [group=g2]
        Arch [label="ðŸ›ï¸ Architect Reviewer"]
        Sim  [label="ðŸ§  Mental Simulation", shape=ellipse, fillcolor="#ffffff"]
        
        Arch -> Sim
    }

    // --- Phase 3: Execution ---
    subgraph cluster_2 {
        label = "Phase 3: Execution";
        color = "#f3e5f5";
        style = "filled,dashed";
        fillcolor = "#f3e5f5";
        
        node [group=g3]
        Iter [label="ðŸ­ Factory Iterator"]
        Track [label="ðŸ—„ï¸ tracker.json", shape=note, fillcolor="#ffffff"]
        Work [label="ðŸ‘· Worker Agents"]
        
        Iter -> Track -> Work
    }

    // --- Phase 4: Validation ---
    subgraph cluster_3 {
        label = "Phase 4: Validation";
        color = "#ffebee";
        style = "filled,dashed";
        fillcolor = "#fffde7";

        node [group=g4]
        CI_Gate [label="ðŸ¤– CI Checker", shape=diamond, fillcolor="#ffffff"]
        Rep     [label="ðŸ©¹ Self-Healing", fillcolor="#ffccbc"]
        Merg    [label="âœ… Merge & Advance", fillcolor="#c8e6c9"]
        
        CI_Gate -> Merg [label="Pass"]
        CI_Gate -> Rep [label="Fail"]
    }

    // --- é‚è¼¯é€£æŽ¥ (ä¸åŠ ç´„æŸä»¥ç¶­æŒæŽ’ç‰ˆç©©å®š) ---
    edge [constraint=false]
    D_UI -> Arch [label="No"]
    VisD -> Arch
    Sim -> Iter
    Work -> CI_Gate [label="PR Submitted"]
    
    // å›žé¥‹è·¯å¾‘
    Rep -> Work [color="#e57373", tailport=w, headport=w]
}
```
:::
::::