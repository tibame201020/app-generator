# 🏭 Coding Style Rules (從 ECC 啟發)

本文件定義了本工廠所有 Worker Agent 必須遵守的編碼準則。

## 1. 核心原則：不可變性 (Immutability) [CRITICAL]
- **嚴禁原地修改 (In-place Mutation)**：除非是效能關鍵路徑且經過 Architect 許可，否則禁止修改傳入的參數或外部變數。
- **總是產生新物件**：使用 `spread operator`、`map`、`filter` 等函數式方法產生更新後的資料。
- **理由**：減少副作用 (Side Effects)，確保狀態回溯與併發安全。

## 2. 顯式錯誤處理 (Explicit Error Handling)
- **嚴禁靜默失敗 (Silent Failure)**：不准使用空的 `catch` 塊。
- **防禦性提早回傳 (Fail Fast)**：在函數開頭進行參數校驗，不符合則立即拋出異常或回傳錯誤物件。
- **上下文豐富**：錯誤訊息必須明確指出出錯的模組與可能的失敗原因。

## 3. 輸入驗證 (Boundary Validation)
- **不信任原則**：所有來自 API、資料庫、文件系統或使用者輸入的資料，在進入業務邏輯層前必須經過驗證。
- **Schema 驅動**：偏向使用 Zod、Pydantic 或相關技術進行強型別校驗。

## 4. 檔案與函數結構
- **認知負荷控制**：
  - 單一檔案建議不超過 **300 行**。
  - 單一函數建議不超過 **50 行**。
  - 巢狀深度不超過 **4 層**。

## 5. 註釋規範
- **解釋「為什麼」而非「是什麼」**：代碼本身應該具備自釋性 (Self-documenting)，註釋應用於解釋複雜決策或演算法背景。
